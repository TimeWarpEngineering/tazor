<Project>
  <!-- Run after https://github.com/dotnet/sdk/blob/main/src/RazorSdk/Targets/Microsoft.NET.Sdk.Razor.SourceGenerators.targets#L15 -->
  <Target Name="_PrepareRazorSourceGeneratorsToolset"
    BeforeTargets="GenerateMSBuildEditorConfigFileShouldRun"
    DependsOnTargets="_PrepareRazorSourceGenerators">

    <ItemGroup>
      <Analyzer Remove="@(_RazorAnalyzer)" />
    </ItemGroup>

    <PropertyGroup>
      <_RazorSdkSourceGeneratorDirectoryRootOverride>$(MSBuildThisFileDirectory)..\source-generators\</_RazorSdkSourceGeneratorDirectoryRootOverride>
    </PropertyGroup>

    <ItemGroup>
      <_RazorAnalyzerOverride Include="$(_RazorSdkSourceGeneratorDirectoryRootOverride)*.dll" />
      <Analyzer Include="@(_RazorAnalyzerOverride)" />
    </ItemGroup>
  </Target>

  <PropertyGroup>
    <RazorUpToDateReloadFileTypes>$(RazorUpToDateReloadFileTypes);.tazor</RazorUpToDateReloadFileTypes>
  </PropertyGroup>

  <ItemGroup Condition="'$(EnableDefaultItems)'=='true' and '$(EnableDefaultContentItems)'=='true'">
  <Content Update="**/*.tazor"
       ExcludeFromSingleFile="true"
       CopyToPublishDirectory="Never" />
    <None Remove="**/*.tazor" />
  </ItemGroup>

  <ItemGroup>
    <UpToDateCheckInput Include="@(Content->WithMetadataValue('Extension', '.tazor'))" />
  </ItemGroup>

  <Target Name="_ClassifyTazorRazorComponents"
          BeforeTargets="ResolveRazorComponentInputs">
    <ItemGroup Condition="'$(EnableDefaultRazorComponentItems)'=='true'">
      <RazorComponent Include="@(Content)"
                      Condition="'%(Content.Extension)'=='.tazor'" />
    </ItemGroup>
  </Target>

  <Target Name="_NormalizeTazorContentMetadata"
          AfterTargets="ResolveRazorComponentInputs">
    <ItemGroup>
      <Content Condition="'%(Content.Extension)'=='.tazor'" CopyToPublishDirectory="Never" />
    </ItemGroup>
  </Target>
</Project>
